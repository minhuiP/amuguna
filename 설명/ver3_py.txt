from flask import Flask, render_template, redirect, url_for, request
import sqlite3
import random

app = Flask(__name__)

def get_random_food_and_tag():
    conn = sqlite3.connect('amuguna.db')
    c = conn.cursor()
    c.execute("SELECT food_name, tag1, tag2, tag3, tag4 FROM amuguna_food ORDER BY RANDOM() LIMIT 1")
    food = c.fetchone()
    tags = (food[1],food[2],food[3],food[4])
    conn.close()
    return food[0], tags

@app.route('/')
def index():
    food_name, tags = get_random_food_and_tag()
    random_tag = random.choice(tags)
    return render_template('index.html', food_name=food_name, tags=tags, random_tag=random_tag)

@app.route('/select', methods=['POST'])
def select():
    return redirect(url_for('congrats'))

@app.route('/congrats')
def congrats():
    return render_template('chuka.html')

@app.route('/tag', methods=['POST'])
def tag():
    food_name = request.form['food_name']
    tag1 = request.form['tag1']
    tag2 = request.form['tag2']
    tag3 = request.form['tag3']
    tag4 = request.form['tag4']
    new_food_name, new_tags = get_random_food_and_tag()
    random_tag = random.choice(new_tags)
    return render_template('index.html', food_name=new_food_name, tags=new_tags, random_tag=random_tag)

if __name__ == '__main__':
    app.run(host='localhost', port=8000)